<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Self-Assessment Onderzoeksvraag</title>
    <!-- Normalize CSS (or Reset CSS) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
      integrity="sha512-NhSC1YmJo4JxhDEWqpNWUAYnKjoUt4xGaoz9RsGeqvVq7uQMHA5jzJEw9K9GYconVovQzlWHNH4U/87QGXvNZA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Materialize CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
      rel="stylesheet"
    />
    <!-- Material Icons -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <style>
      /* Visually Hidden class for accessibility */
      .visually-hidden {
        position: absolute !important;
        width: 1px !important;
        height: 1px !important;
        padding: 0 !important;
        margin: -1px !important;
        overflow: hidden !important;
        clip: rect(0, 0, 0, 0) !important;
        white-space: nowrap !important;
        border: 0 !important;
      }

      body {
        padding: 20px;
        font-size: 1rem; /* Base font size */
      }

      .card {
        margin-bottom: 20px;
      }

      .indented-list {
        margin-left: 20px;
        padding-left: 20px;
      }

      .indented-list li {
        list-style-type: disc !important; /*Force bullets */
        display: list-item !important; /*Ensure li is treated as a list item*/
      }

      /* Reflection questions icon styling */
      .reflection-list {
        list-style: none;
        padding-left: 0; /*Remove indentation from the bullet */
      }

      .reflection-list li {
        display: flex; /* Enable flexbox layout */
        align-items: center; /* Vertically center the icon and text */
        margin-bottom: 0.5em;
      }

      .reflection-list li i.material-icons {
        margin-right: 0.5em; /* Adjust spacing between icon and text */
        font-size: 1.2em; /* Adjust icon size as needed */
        /* vertical-align: middle; /* Align icon vertically within the li */
      }

      /* Optional: Style for the loading spinner */
      .spinner-container {
        text-align: center;
        margin-top: 20px;
      }

      /* Adjust text size responsively */
      h1 {
        font-size: 2rem;
      }

      h3 {
        font-size: 1.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container" id="content">
      <h1 class="center">Self-Assessment Onderzoeksvraag</h1>

      <!-- Instructies -->
      <div class="card blue lighten-5">
        <div class="card-content">
          <span class="card-title">Instructies</span>
          <ul class="indented-list">
            <li>
              Voor elke eindkwalificatie zijn beoordelingscriteria geformuleerd.
            </li>
            <li>
              Beoordeel in hoeverre je onderzoeksvraag en de beoogde aanpak
              aansluiten bij deze criteria.
            </li>
            <li>
              Gebruik de reflectievragen om dieper na te denken over mogelijke
              verbeteringen.
            </li>
            <li>Vul alle velden in het formulier zo volledig mogelijk in.</li>
            <li>
              Klik op de "Bewaar als PDF" knop om een rapport te genereren.
            </li>
            <hr />
            <li>
              <strong>Gebruik het gegenereerde rapport:</strong>
              <ul class="indented-list">
                <li>
                  ... als basis voor een gesprek met je begeleider over de focus
                  en aanpak van je onderzoek.
                </li>
                <li>
                  ... om je onderzoeksvraag verder aan te scherpen en te
                  verfijnen.
                </li>
                <li>
                  ... als onderdeel van je reflectie op je professionele
                  ontwikkeling.
                </li>
              </ul>
            </li>
            <hr />
            <li>
              <strong>NB: </strong>De gegevens in dit formulier en de
              bijbehorende rapportage zijn strikt vertrouwelijk en uitsluitend
              bestemd voor persoonlijk gebruik. Deze informatie wordt op geen
              enkele wijze gedeeld met of verzonden naar externe partijen.
            </li>
          </ul>
        </div>
      </div>

      <form id="selfAssessmentForm">
        <fieldset>
          <legend>Studentgegevens</legend>
          <div class="row">
            <div class="input-field col s12 m6">
              <input id="studentName" type="text" name="studentName" required />
              <label for="studentName">Voornaam student</label>
            </div>
            <div class="input-field col s12 m6">
              <input
                id="assessmentDate"
                type="date"
                name="assessmentDate"
                required
              />
              <label for="assessmentDate">Datum</label>
            </div>
          </div>
        </fieldset>

        <!-- Onderzoeksvraag -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">Onderzoeksvraag</span>
            <div class="input-field">
              <textarea
                id="researchQuestion"
                class="materialize-textarea"
                name="researchQuestion"
                rows="4"
                required
              ></textarea>
              <label for="researchQuestion"
                >Voer hier de tekst van je onderzoeksvraag in</label
              >
            </div>
          </div>
        </div>

        <!-- Vraag 1: Probleem herkennen en diagnosticeren -->
        <div class="card">
          <div class="card-content">
            <span class="card-title"
              >1. Probleem herkennen en diagnosticeren</span
            >
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>
                Beschrijft een complex bedrijfskundig vraagstuk vanuit een
                integraal perspectief
              </li>
              <li>
                Identificeert en analyseert mogelijke oorzaken en dwarsverbanden
              </li>
              <li>Gebruikt geschikte bedrijfskundige analysetechnieken</li>
              <li>Stelt een passende bedrijfskundige diagnose</li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  In hoeverre is mijn onderzoeksvraag gericht op een complex en
                  integraal bedrijfskundig vraagstuk?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response1"
                class="materialize-textarea"
                name="response1"
                rows="4"
                aria-describedby="question1-description"
              ></textarea>
              <label for="response1">Jouw antwoord</label>
            </div>
            <p id="question1-description" class="visually-hidden">
              Answer to question about recognizing and diagnosing problems.
            </p>
          </div>
        </div>

        <!-- Vraag 2: Ontwerpen -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">2. Ontwerpen</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>
                Levert op basis van de diagnose verschillende
                oplossingsrichtingen en één voorkeursontwerp
              </li>
              <li>Oplossingsrichtingen zijn gebaseerd op nieuwe ideeën</li>
              <li>
                Houdt rekening met het programma van eisen, praktijkvoorbeelden
                en de laatste ontwikkelingen en trends
              </li>
              <li>Verbetert bedrijfsprocessen</li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe leidt mijn onderzoeksvraag tot het ontwerpen van meerdere
                  oplossingsrichtingen?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response2"
                class="materialize-textarea"
                name="response2"
                rows="4"
                aria-describedby="question2-description"
              ></textarea>
              <label for="response2">Jouw antwoord</label>
            </div>
            <p id="question2-description" class="visually-hidden">
              Answer to question about designing solutions.
            </p>
          </div>
        </div>

        <!-- Vraag 3: Veranderen -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">3. Veranderen</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>
                Begeleidt een complexe bedrijfskundige verandering met
                uiteenlopende belangen
              </li>
              <li>
                Kan zelfstandig een integraal advies opstellen en uitbrengen
              </li>
              <li>
                Draagt zorg voor implementatie en borging van de oplossing
              </li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe adresseert mijn onderzoeksvraag de begeleiding van een
                  complexe verandering met diverse belangen?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response3"
                class="materialize-textarea"
                name="response3"
                rows="4"
                aria-describedby="question3-description"
              ></textarea>
              <label for="response3">Jouw antwoord</label>
            </div>
            <p id="question3-description" class="visually-hidden">
              Answer to question about managing change.
            </p>
          </div>
        </div>

        <!-- Vraag 4: Evalueren -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">4. Evalueren</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>Beoordeelt de effectiviteit van verbeteracties</li>
              <li>Adviseert over de verdere ontwikkeling van de organisatie</li>
              <li>
                Evaluatie is gericht op de eerder gemaakte keuzes (diagnose en
                ontwerp)
              </li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe zal mijn onderzoeksvraag leiden tot het evalueren van de
                  effectiviteit van verbeteracties?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response4"
                class="materialize-textarea"
                name="response4"
                rows="4"
                aria-describedby="question4-description"
              ></textarea>
              <label for="response4">Jouw antwoord</label>
            </div>
            <p id="question4-description" class="visually-hidden">
              Answer to question about evaluating effectiveness.
            </p>
          </div>
        </div>

        <!-- Vraag 5: Onderzoekend vermogen -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">5. Onderzoekend vermogen</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>
                Ontwerpt en voert op methodische wijze een praktijkgericht
                onderzoek uit
              </li>
              <li>
                Maakt een verantwoorde keuze voor een onderzoeksaanpak passend
                bij het vraagstuk
              </li>
              <li>Past kennis uit beschikbaar onderzoek toe</li>
              <li>Toont een kritische, nieuwsgierige en open houding</li>
              <li>Verantwoordt het methodisch handelen</li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe stelt mijn onderzoeksvraag mij in staat om een methodisch
                  en praktijkgericht onderzoek op te zetten dat voldoet aan de
                  beoordelingscriteria voor onderzoekend vermogen?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response5"
                class="materialize-textarea"
                name="response5"
                rows="4"
                aria-describedby="question5-description"
              ></textarea>
              <label for="response5">Jouw antwoord</label>
            </div>
            <p id="question5-description" class="visually-hidden">
              Answer to question about research capabilities.
            </p>
          </div>
        </div>

        <!-- Vraag 6: Sociaal-communicatieve vaardigheden -->
        <div class="card">
          <div class="card-content">
            <span class="card-title"
              >6. Sociaal-communicatieve vaardigheden</span
            >
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>
                Zet communicatie doelbewust in en afgestemd op de doelgroep
              </li>
              <li>Creëert draagvlak bij stakeholders</li>
              <li>Motiveert mensen tot een constructieve bijdrage</li>
              <li>Toont bewustzijn van de persoonlijke rol</li>
              <li>Kan gespreksvaardigheden inzetten om doelen te bereiken</li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe vereist mijn onderzoeksvraag effectieve communicatie met
                  diverse stakeholders?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response6"
                class="materialize-textarea"
                name="response6"
                rows="4"
                aria-describedby="question6-description"
              ></textarea>
              <label for="response6">Jouw antwoord</label>
            </div>
            <p id="question6-description" class="visually-hidden">
              Answer to question about social-communicative skills.
            </p>
          </div>
        </div>

        <!-- Vraag 7: Schakelen en verbinden -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">7. Schakelen en verbinden</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>Is regisseur van het onderzoeksproces</li>
              <li>Kan contacten inzetten in diverse situaties</li>
              <li>
                Legt relevante verbindingen tussen mensen, functies/disciplines
                en niveaus
              </li>
              <li>Is bewust van culturele diversiteit</li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe stelt mijn onderzoeksvraag mij in staat om het
                  onderzoeksproces effectief te leiden?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response7"
                class="materialize-textarea"
                name="response7"
                rows="4"
                aria-describedby="question7-description"
              ></textarea>
              <label for="response7">Jouw antwoord</label>
            </div>
            <p id="question7-description" class="visually-hidden">
              Answer to question about connecting and bridging.
            </p>
          </div>
        </div>

        <!-- Vraag 8: Professionaliseren -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">8. Professionaliseren</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>
                Verspreidt en borgt opgedane kennis ter ontwikkeling van de
                organisatie en de beroepspraktijk
              </li>
              <li>Verantwoordt eigen handelen</li>
              <li>
                Reflecteert continu op eigen handelen en het toekomstige
                ontwikkelproces
              </li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Hoe draagt mijn onderzoeksvraag bij aan het genereren van
                  kennis die waardevol is voor zowel de organisatie als de
                  bredere bedrijfskundige praktijk?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response8"
                class="materialize-textarea"
                name="response8"
                rows="4"
                aria-describedby="question8-description"
              ></textarea>
              <label for="response8">Jouw antwoord</label>
            </div>
            <p id="question8-description" class="visually-hidden">
              Answer to question about professionalization.
            </p>
          </div>
        </div>

        <!-- Vraag 9: Handelen vanuit waarden -->
        <div class="card">
          <div class="card-content">
            <span class="card-title">9. Handelen vanuit waarden</span>
            <p><strong>Criteria:</strong></p>
            <ul class="indented-list">
              <li>Is bewust van de gehanteerde waarden en normen</li>
              <li>Legt verantwoording af over gemaakte keuzes</li>
              <li>
                Streeft naar duurzame en maatschappelijk verantwoorde
                oplossingen
              </li>
            </ul>
            <p><strong>Reflectievraag:</strong></p>
            <ul class="reflection-list">
              <li>
                <i class="material-icons">lightbulb_outline</i>
                <span>
                  Welke ethische overwegingen spelen een rol in mijn
                  onderzoeksvraag, en hoe adresseer ik deze?</span
                >
              </li>
            </ul>
            <div class="input-field">
              <textarea
                id="response9"
                class="materialize-textarea"
                name="response9"
                rows="4"
                aria-describedby="question9-description"
              ></textarea>
              <label for="response9">Jouw antwoord</label>
            </div>
            <p id="question9-description" class="visually-hidden">
              Answer to question about acting from values.
            </p>
          </div>
        </div>

        <!-- Bewaar als PDF knop -->
        <div class="row">
          <div class="col s12 center">
            <button
              type="button"
              id="savePdf"
              class="btn waves-effect waves-light"
            >
              Bewaar als PDF
              <i class="material-icons right">picture_as_pdf</i>
            </button>
          </div>
        </div>
      </form>

      <!-- Loading Spinner (hidden by default) -->
      <div id="loadingSpinner" class="spinner-container" style="display: none">
        <div class="preloader-wrapper big active">
          <div class="spinner-layer spinner-blue">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>

          <div class="spinner-layer spinner-red">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>

          <div class="spinner-layer spinner-yellow">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>

          <div class="spinner-layer spinner-green">
            <div class="circle-clipper left">
              <div class="circle"></div>
            </div>
            <div class="gap-patch">
              <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
              <div class="circle"></div>
            </div>
          </div>
        </div>
        <p>Bezig met genereren van PDF...</p>
      </div>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        M.updateTextFields();
      });

      function showLoadingSpinner() {
        document.getElementById("loadingSpinner").style.display = "block";
      }

      function hideLoadingSpinner() {
        document.getElementById("loadingSpinner").style.display = "none";
      }

      function collectFormData() {
        const formData = new FormData(
          document.getElementById("selfAssessmentForm")
        );
        const studentName = formData.get("studentName");
        const assessmentDate = formData.get("assessmentDate");
        const researchQuestion = formData.get("researchQuestion");

        if (!studentName || !assessmentDate || !researchQuestion) {
          M.toast({ html: "Vul alle verplichte velden in!" }); // Use Materialize toast
          return null; // Indicate validation failure
        }

        const responses = Array.from({ length: 9 }, (_, i) => {
          const element = document.getElementById(`response${i + 1}`);
          return element ? element.value : ""; // Handle potential missing elements
        });

        return {
          studentName,
          assessmentDate,
          researchQuestion,
          responses,
        };
      }

      function generatePdfDocument(formData) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
          orientation: "portrait",
          unit: "pt",
          format: "a4",
        });

        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();

        // Set default font
        doc.setFont("helvetica", "normal", "normal");

        // Header on first page
        doc.setFontSize(16);
        doc.text("Self-Assessment Rapport", 40, 40);
        doc.setFontSize(12);
        let y = 70;

        doc.text("Naam student: " + formData.studentName, 40, y);
        y += 20;
        doc.text("Datum: " + formData.assessmentDate, 40, y);
        y += 20;
        doc.text("Onderzoeksvraag: " + formData.researchQuestion, 40, y);
        y += 30;

        // Reflection questions array (for questions 1-9)
        const reflectionQuestions = [
          "In hoeverre is mijn onderzoeksvraag gericht op een complex en integraal bedrijfskundig vraagstuk?",
          "Hoe leidt mijn onderzoeksvraag tot het ontwerpen van meerdere oplossingsrichtingen?",
          "Hoe adresseert mijn onderzoeksvraag de begeleiding van een complexe verandering met diverse belangen?",
          "Hoe zal mijn onderzoeksvraag leiden tot het evalueren van de effectiviteit van verbeteracties?",
          "Hoe stelt mijn onderzoeksvraag mij in staat om een methodisch en praktijkgericht onderzoek op te zetten dat voldoet aan de beoordelingscriteria voor onderzoekend vermogen?",
          "Hoe vereist mijn onderzoeksvraag effectieve communicatie met diverse stakeholders?",
          "Hoe stelt mijn onderzoeksvraag mij in staat om het onderzoeksproces effectief te leiden?",
          "Hoe draagt mijn onderzoeksvraag bij aan het genereren van kennis die waardevol is voor zowel de organisatie als de bredere bedrijfskundige praktijk?",
          "Welke ethische overwegingen spelen een rol in mijn onderzoeksvraag, en hoe adresseer ik deze?",
        ];

        const xOffsetQuestion = 40;
        const xOffsetAnswer = 40;

        doc.setFontSize(12);

        for (let i = 0; i < 9; i++) {
          // Process the question
          const question = i + 1 + ". " + reflectionQuestions[i];
          let questionLines = doc.splitTextToSize(
            question,
            pageWidth - 2 * xOffsetQuestion - 20
          );

          if (y + questionLines.length * 14 + 20 > pageHeight - 50) {
            doc.addPage();
            y = 70;
            addPageHeader(doc);
            doc.setFontSize(12); // Reset font size for content
          }

          for (const line of questionLines) {
            doc.text(line, xOffsetQuestion, y);
            y += 14;
          }
          y += 5;

          // Process the answer
          const answer = "Antwoord: " + formData.responses[i];
          let answerLines = doc.splitTextToSize(
            answer,
            pageWidth - 2 * xOffsetAnswer - 20
          );

          if (y + answerLines.length * 14 + 20 > pageHeight - 50) {
            doc.addPage();
            y = 70;
            addPageHeader(doc);
            doc.setFontSize(12); // Reset font size for content
          }

          for (const line of answerLines) {
            doc.text(line, xOffsetAnswer, y);
            y += 14;
          }
          y += 30;
        }

        // General Reflection questions at the end
        doc.setFontSize(12);
        doc.text("Algemene Reflectie", 40, y);
        y += 20;

        const generalQuestions = [
          "In hoeverre biedt mijn onderzoeksvraag voldoende aanknopingspunten om alle eindkwalificaties aan te tonen?",
          "Welke aspecten van mijn onderzoeksvraag kunnen verder worden ontwikkeld of aangescherpt om beter aan te sluiten bij de beoordelingscriteria?",
          "Hoe zorg ik ervoor dat mijn onderzoek een integrale bijdrage levert aan zowel mijn eigen professionele ontwikkeling als aan de organisatie en de bredere maatschappij?",
        ];

        for (let i = 0; i < 3; i++) {
          const question = i + 1 + ". " + generalQuestions[i];
          let questionLines = doc.splitTextToSize(question, pageWidth - 80);

          if (y + questionLines.length * 14 + 20 > pageHeight - 50) {
            doc.addPage();
            y = 70;
            addPageHeader(doc);
            doc.setFontSize(12); // Reset font size for content
          }
          doc.text(questionLines, 40, y);
          y += questionLines.length * 14 + 20;
        }

        // Footer with page numbers on all pages
        const totalPages = doc.internal.getNumberOfPages();
        doc.setFontSize(10);
        for (let i = 1; i <= totalPages; i++) {
          doc.setPage(i);
          const footerText = `Pagina ${i} van ${totalPages}`;
          doc.text(
            footerText,
            pageWidth / 2 - doc.getTextWidth(footerText) / 2,
            pageHeight - 30
          );
        }

        return doc;
      }

      function addPageHeader(doc) {
        // Add header content (header font size is set to 14)
        doc.setFontSize(14);
        doc.text("Self-Assessment Rapport", 40, 40);
      }

      function savePdfFile(doc, name) {
        const fileName =
          "self-assessment-rapport-" + name.toLowerCase() + ".pdf";
        doc.save(fileName);
      }

      document.getElementById("savePdf").addEventListener("click", function () {
        showLoadingSpinner(); // Show loading spinner
        try {
          const formData = collectFormData();
          if (!formData) {
            hideLoadingSpinner(); // Hide loading spinner if validation fails
            return; // Validation failed
          }

          const doc = generatePdfDocument(formData);
          savePdfFile(doc, formData.studentName);
        } catch (error) {
          console.error("Fout bij het genereren van PDF:", error);
          M.toast({
            html: "Er is een fout opgetreden bij het genereren van de PDF. Zie de console voor details.",
          }); // Use Materialize toast
        } finally {
          hideLoadingSpinner(); // Always hide loading spinner after attempt (success or failure)
        }
      });
    </script>
  </body>
</html>
